<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="James Shubin">

	<title>why linux is powerful or: how to erase half your system and then fix it - https://purpleidea.com/</title>
	<link rel="canonical" href="https://purpleidea.com/blog/2009/10/14/why-linux-is-powerful-or-how-to-erase-half-your-system-and-then-fix-it/">

	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<link href="/css/font-awesome.css" rel="stylesheet">
	<link href="/css/custom.css" rel="stylesheet">
	<link href="/css/staticman.css" rel="stylesheet">

	
</head>
<body>
	<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
					<span class="sr-only">Toggle Navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="https://purpleidea.com/">purpleidea.com</a>
			</div>
			<div class="collapse navbar-collapse navbar-ex1-collapse">
				<ul class="nav navbar-nav">

					<li><a href="/about/">about</a></li>
					<li><a href="/blog/">blog</a></li>
					<li><a href="/contact/">contact</a></li>
					<li><a href="/misc/">misc</a></li>
					<li><a href="/talks/">talks</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container">

	<div class="row">
		<div class="col-md-9">
			<div class="well well-sm">
					<h3><strong>why linux is powerful or: how to erase half your system and then fix it</strong><br><small></small></h3>
					<hr>
					<p>after a brief bout of stupidity i quickly realized that my makefile had gone awry and was quickly eating through my filesystem.</p>

<p>after ^C killing it, it seems i only took out most of /lib/* and /usr/sbin/* &ndash; who needs those anyways&hellip; apparently almost everyone.</p>

<p>what happened next. well it turns out i was lucky and had a few shells and a webbrowser open&ndash; attempts to launch new programs will fail, but existing programs are already loaded in memory so i was able to work.</p>

<p>since almost everything was broken, i first had to get dpkg and apt/apt-utils going again. after much anguish, i manually installed the missing library files and binaries from <a href="http://packages.ubuntu.com/">http://packages.ubuntu.com/</a> and i was on my way with apt.</p>

<p>if you&rsquo;re manually installing files from .deb&rsquo;s use:</p>

<pre><code>dpkg -x &lt;package_file.deb&gt; outputfolder/
</code></pre>

<p>which will let you get in and use mv and cp to put back the missing .so files.
once some basic tools were working, you can try and fix up your tool chain doing things like:</p>

<pre><code>sudo apt-get --reinstall install &lt;package_name&gt;
</code></pre>

<p>it&rsquo;s good to do this to apt-utils, dpkg, and whatever other utilities are throwing library errors. the packages themselves need various utilities installed, and as you get a missing abc.so file, find out what package it needs with:</p>

<pre><code>dpkg -S &lt;filename&gt;
</code></pre>

<p>my apt seems to be back, but many utilities still aren&rsquo;t. finding out what should go in /lib was a little harder but i was able to get a list of packages like this:</p>

<p>(find out what <em>should</em> be installed)</p>

<pre><code>dpkg --get-selections &gt; installed-software
</code></pre>

<p>(list which files come from these packages, sort and uniq it)</p>

<pre><code>dpkg -L `cat installed-software` | sort | uniq &gt; uniq-software
</code></pre>

<p>(find what we deleted)</p>

<pre><code>cat uniq-software | grep ^/lib/ &gt; missing-software
</code></pre>

<p>(which packages does this come from, sort and uniq it. (might get too long argument list))</p>

<pre><code>dpkg -S `cat missing-software` &gt; package-list
</code></pre>

<p>(find the package name by itself, get rid of the colons, sort, uniq)</p>

<pre><code>cat package-list | awk '{print $1}' | sed -e 's/://' | sed -e 's/,//' | sort | uniq &gt; reinstall-me
</code></pre>

<p>(do the reinstall)</p>

<pre><code>sudo apt-get --reinstall install `cat reinstall-me`
</code></pre>

<p>at the moment this is running, and i luckily had a cd lying around to help speed up the process. use:</p>

<pre><code>apt-cdrom add
</code></pre>

<p>(with the cd in the drive) to add it to your /etc/apt/sources.list</p>

<p>turns out this eventually failed with some obscure errors&hellip; it ultimately might be a more concise list if you know what got killed, but i think the sheer number of packages i messed up and that needed to get updated somehow confused apt with some cyclical cycles, and i had to go about it slightly more manually and generally.</p>

<p>first of all, when every i had an annoying library error, i ran this script:</p>

<pre><code>#!/bin/bash
in=`echo $1 | sed -e 's/://'`
fix=`dpkg -S $in | awk '{print $1}' | sed -e 's/://'`
sudo apt-get -y --reinstall install $fix
</code></pre>

<p>which would reinstall the missing library. since i ended up doing this rather repetitively, it helped a lot.</p>

<p>secondly, i was forced to run something like this:</p>

<pre><code>for i in `cat get-selections`; do
sudo apt-get -y --reinstall install $i;
done
</code></pre>

<p>which reinstalls each package. slowly after pruning the list for problem packages, and deleting the successful ones, my system came back. at one point you won&rsquo;t have to run them individually, and you can run:</p>

<pre><code>sudo apt-get --reinstall install `cat get-selections`
</code></pre>

<p>and be done! i finished with a:</p>

<pre><code>do-release-upgrade
</code></pre>

<p>and now things are looking great. luckily no important user files were squished, and hopefully this is a good reference for you. i hopefully won&rsquo;t have to reference it again for all the dpkg commands i&rsquo;ll forget.</p>

			</div>
		</div>

		
		<div class="col-md-3">
			<div class="well well-sm"> 
				<h4>October 14, 2009<br>
				<small>615 words</small></h4>
				<hr>
				<strong>Categories</strong>
				<ul class="list-unstyled">
				
					<li><a href="/categories/technical">technical</a></li>
				
				</ul>
				<hr>
				<strong>Tags</strong><br>
				<a class="label label-default" href="/tags/apt-get">apt-get</a> <a class="label label-default" href="/tags/bad">bad</a> <a class="label label-default" href="/tags/dpkg">dpkg</a> <a class="label label-default" href="/tags/linux">linux</a> <a class="label label-default" href="/tags/makefile">makefile</a> 
				
				<hr>
				<strong>Original URL</strong><br>
				<a href="https://ttboj.wordpress.com/2009/10/14/why-linux-is-powerful-or-how-to-erase-half-your-system-and-then-fix-it/"><small>https://ttboj.wordpress.com/2009/10/14/why-linux-is-powerful-or-how-to-erase-half-your-system-and-then-fix-it/</small></a>
				

				
			</div>
				<div class="panel panel-default">
		<div class="panel-heading" style="padding: 2px 15px;">
			<h4>Oh hello...</h4>
		</div>
		<div class="panel-body">

			<a href="https://twitter.com/purpleidea" class="btn btn-info btn-xs"><i class="fa fa-twitter-square fa-2x"></i></a>


			<a href="https://github.com/purpleidea/" class="btn btn-primary btn-xs"><i class="fa fa-github-square fa-2x"></i></a>



			<div class="alert alert-info alert-dismissable" style="margin-top:25px;margin-bottom:5px;">
				<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
				<strong>Hey, hacker!</strong><br>
				You should follow me to get new updates!
			</div>
		</div>
	</div>

		</div>
	</div>

	<div class="row">
		<hr>

	<a name="comments"></a>
<section class="post-comments">
	<h3>Comments</h3>






	

	


	<p>Nothing yet.</p>

	<hr />
	<a name="comment"></a>
	<h3>Post a comment</h3>
	<form class="post-new-comment" method="POST" action="https://api.staticman.net/v2/entry/purpleidea/purpleidea.com/master/comments">
		<input type="hidden" name="options[redirect]" value="https://purpleidea.com/blog/2009/10/14/why-linux-is-powerful-or-how-to-erase-half-your-system-and-then-fix-it/#comment-submitted">
		<input type="hidden" name="options[entryId]" value="blog/2009/10/14/why-linux-is-powerful-or-how-to-erase-half-your-system-and-then-fix-it">
		<input type="hidden" name="options[reCaptcha][siteKey]" value="6Lc0u2EUAAAAAImKX7XafINIzeoLZFQCGFKF7qCp">
		<input type="hidden" name="options[reCaptcha][secret]" value="AEl4ul2uMOx2EL2LMm/84zzh8mWLYIYW&#43;v2EEu7webGOtAqyQiLBa6QLjPgnlyNjJxE3UeccxuBQIWqPzG96FsVl0AVTihhHt3OGR1hteAZUAhoJjnH&#43;7PoyC3x7d4KDLypopDn&#43;HzWowOpAZuvfHE08n&#43;G4omrP5fUfkOrH03A=">
		<div class="col-md-9">
			<div class="row">
				<textarea name="fields[message]" style="width: 80%; height: 50px;" class="post-comment-field" placeholder="Please enter your comment here..." rows="10"></textarea><br />
			</div>
			<div class="row">
				<input name="fields[name]" type="text" style="width: 50%;" class="post-comment-field" placeholder="Your name">
			</div>
			<div class="row">
				<input name="fields[email]" type="email" style="width: 50%;" class="post-comment-field" placeholder="Your email address">
			</div>
			<div class="row">
				<input name="fields[url]" type="text" style="width: 50%;" class="post-comment-field" placeholder="Your website">
			</div>
			<div class="row">
				<br />
				<div class="g-recaptcha" data-sitekey="6Lc0u2EUAAAAAImKX7XafINIzeoLZFQCGFKF7qCp"></div>
				<script src='https://www.google.com/recaptcha/api.js'></script>
				(sorry but the spammers were getting too crazy!)
			</div>
			<div class="row">
				<input type="submit" style="width: 80%;" class="post-comment-field btn btn-primary btn-xs" value="Submit">
			</div>
		</div>
	</form>
</section>

<div id="comment-submitted" class="dialog">
	<hr />
	<h3>Thank you</h3>
	<p>Your comment has been submitted and will be published if it gets approved.</p>
	<p><a href="https://github.com/purpleidea/purpleidea.com/pulls">Click here</a> to see the patch you generated.</p>
	<p><a href="#" class="btn">OK</a></p>
</div>

	</div>
		<footer>
		<div class="row">
			<hr>
			<div class="col-sm-12">
				<p>
				&copy; James Shubin 2018 &middot;
				<a href="https://purpleidea.com/">https://purpleidea.com/</a> &middot;
				<a href="https://github.com/purpleidea/purpleidea.com/blob/master/content/blog/2009/10/14/why-linux-is-powerful-or-how-to-erase-half-your-system-and-then-fix-it.md" style="color:grey">Edit this page</a>
				</p>
			</div>
		</div>
		</footer>
	</div>

	<script src="/js/jquery-1.11.3.min.js"></script>
	<script src="/js/bootstrap.js"></script>
</body>
</html>

