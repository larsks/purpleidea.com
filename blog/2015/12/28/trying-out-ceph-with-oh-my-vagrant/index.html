<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="James Shubin">

	<title>Trying out Ceph with Oh-My-Vagrant - https://purpleidea.com/</title>
	<link rel="canonical" href="https://purpleidea.com/blog/2015/12/28/trying-out-ceph-with-oh-my-vagrant/">

	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<link href="/css/font-awesome.css" rel="stylesheet">
	<link href="/css/custom.css" rel="stylesheet">
	<link href="/css/staticman.css" rel="stylesheet">

	
</head>
<body>
	<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
					<span class="sr-only">Toggle Navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="https://purpleidea.com/">purpleidea.com</a>
			</div>
			<div class="collapse navbar-collapse navbar-ex1-collapse">
				<ul class="nav navbar-nav">

					<li><a href="/about/">about</a></li>
					<li><a href="/blog/">blog</a></li>
					<li><a href="/contact/">contact</a></li>
					<li><a href="/misc/">misc</a></li>
					<li><a href="/talks/">talks</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container">

	<div class="row">
		<div class="col-md-9">
			<div class="well well-sm">
					<h3><strong>Trying out Ceph with Oh-My-Vagrant</strong><br><small></small></h3>
					<hr>
					<p><a href="https://www.berrange.com/posts/2015/12/21/ceph-single-node-deployment-on-fedora-23/">Daniel P. Berrangé wrote about trying out a single node ceph cluster.</a> I decided to take his article and turn it into an Oh-My-Vagrant <code>omv.yaml</code> file. It took me about two minutes to do so, and two hours to debug a problem caused by something I had broken on my laptop.</p>

<p>If you&rsquo;d like to replicate his article in less than 5 minutes, pull down the <a href="https://github.com/purpleidea/oh-my-vagrant/blob/master/examples/ceph-deploy.yaml">omv.yaml</a> file that I&rsquo;ve just published and run <code>omv up</code>. Here&rsquo;s the full terminal output of my session:</p>

<pre><code>james@computer:~/code/oh-my-vagrant/examples$ git pull
Already up-to-date.
james@computer:~/code/oh-my-vagrant/examples$ cdtmpmkdir 
james@computer:/tmp/tmp.DhD$ cp $OLDPWD/ceph-deploy.yaml omv.yaml
james@computer:/tmp/tmp.DhD$ time omv up
Bringing machine 'omv1' up with 'libvirt' provider...
==&gt; omv1: Creating image (snapshot of base box volume).
==&gt; omv1: Creating domain with the following settings...
==&gt; omv1:  -- Name:              omv_omv1
==&gt; omv1:  -- Domain type:       kvm
==&gt; omv1:  -- Cpus:              1
==&gt; omv1:  -- Memory:            512M
==&gt; omv1:  -- Base box:          fedora-23
==&gt; omv1:  -- Storage pool:      default
==&gt; omv1:  -- Image:             /var/lib/libvirt/images/omv_omv1.img
==&gt; omv1:  -- Volume Cache:      default
==&gt; omv1:  -- Kernel:            
==&gt; omv1:  -- Initrd:            
==&gt; omv1:  -- Graphics Type:     spice
==&gt; omv1:  -- Graphics Port:     5900
==&gt; omv1:  -- Graphics IP:       127.0.0.1
==&gt; omv1:  -- Graphics Password: Not defined
==&gt; omv1:  -- Video Type:        qxl
==&gt; omv1:  -- Video VRAM:        9216
==&gt; omv1:  -- Keymap:            en-us
==&gt; omv1:  -- Command line : 
==&gt; omv1: Creating shared folders metadata...
==&gt; omv1: Starting domain.
==&gt; omv1: Waiting for domain to get an IP address...
==&gt; omv1: Waiting for SSH to become available...
==&gt; omv1: Setting hostname...
==&gt; omv1: Configuring and enabling network interfaces...
==&gt; omv1: Rsyncing folder: /tmp/tmp.DhD/ =&gt; /vagrant
==&gt; omv1: Updating /etc/hosts file on active guest machines...
==&gt; omv1: Running provisioner: shell...
    omv1: Running: inline script
==&gt; omv1: Changing password for user root.
==&gt; omv1: passwd: all authentication tokens updated successfully.
==&gt; omv1: Running provisioner: shell...
    omv1: Running: inline script
==&gt; omv1: TARGET SOURCE    FSTYPE OPTIONS
==&gt; omv1: /      /dev/vda3 xfs    rw,relatime,seclabel,attr2,inode64,noquota
==&gt; omv1: TARGET                                SOURCE     FSTYPE     OPTIONS
==&gt; omv1: /                                     /dev/vda3  xfs        rw,relatime,seclabel,attr2,inode64,noquota
==&gt; omv1: ├─/sys                                sysfs      sysfs      rw,nosuid,nodev,noexec,relatime,seclabel
==&gt; omv1: │ ├─/sys/kernel/security              securityfs securityfs rw,nosuid,nodev,noexec,relatime
==&gt; omv1: │ ├─/sys/fs/cgroup                    tmpfs      tmpfs      ro,nosuid,nodev,noexec,seclabel,mode=755
==&gt; omv1: │ │ ├─/sys/fs/cgroup/systemd          cgroup     cgroup     rw,nosuid,nodev,noexec,relatime,xattr,release_agent=/usr/lib/systemd/systemd-cgroups-agent,name=systemd
==&gt; omv1: │ │ ├─/sys/fs/cgroup/devices          cgroup     cgroup     rw,nosuid,nodev,noexec,relatime,devices
==&gt; omv1: │ │ ├─/sys/fs/cgroup/cpu,cpuacct      cgroup     cgroup     rw,nosuid,nodev,noexec,relatime,cpu,cpuacct
==&gt; omv1: │ │ ├─/sys/fs/cgroup/memory           cgroup     cgroup     rw,nosuid,nodev,noexec,relatime,memory
==&gt; omv1: │ │ ├─/sys/fs/cgroup/perf_event       cgroup     cgroup     rw,nosuid,nodev,noexec,relatime,perf_event
==&gt; omv1: │ │ ├─/sys/fs/cgroup/blkio            cgroup     cgroup     rw,nosuid,nodev,noexec,relatime,blkio
==&gt; omv1: │ │ ├─/sys/fs/cgroup/hugetlb          cgroup     cgroup     rw,nosuid,nodev,noexec,relatime,hugetlb
==&gt; omv1: │ │ ├─/sys/fs/cgroup/freezer          cgroup     cgroup     rw,nosuid,nodev,noexec,relatime,freezer
==&gt; omv1: │ │ ├─/sys/fs/cgroup/net_cls,net_prio cgroup     cgroup     rw,nosuid,nodev,noexec,relatime,net_cls,net_prio
==&gt; omv1: │ │ └─/sys/fs/cgroup/cpuset           cgroup     cgroup     rw,nosuid,nodev,noexec,relatime,cpuset
==&gt; omv1: │ ├─/sys/fs/pstore                    pstore     pstore     rw,nosuid,nodev,noexec,relatime,seclabel
==&gt; omv1: │ ├─/sys/fs/selinux                   selinuxfs  selinuxfs  rw,relatime
==&gt; omv1: │ ├─/sys/kernel/debug                 debugfs    debugfs    rw,relatime,seclabel
==&gt; omv1: │ └─/sys/kernel/config                configfs   configfs   rw,relatime
==&gt; omv1: ├─/proc                               proc       proc       rw,nosuid,nodev,noexec,relatime
==&gt; omv1: │ ├─/proc/sys/fs/binfmt_misc          systemd-1  autofs     rw,relatime,fd=27,pgrp=1,timeout=0,minproto=5,maxproto=5,direct
==&gt; omv1: │ └─/proc/fs/nfsd                     nfsd       nfsd       rw,relatime
==&gt; omv1: ├─/dev                                devtmpfs   devtmpfs   rw,nosuid,seclabel,size=242328k,nr_inodes=60582,mode=755
==&gt; omv1: │ ├─/dev/shm                          tmpfs      tmpfs      rw,nosuid,nodev,seclabel
==&gt; omv1: │ ├─/dev/pts                          devpts     devpts     rw,nosuid,noexec,relatime,seclabel,gid=5,mode=620,ptmxmode=000
==&gt; omv1: │ ├─/dev/hugepages                    hugetlbfs  hugetlbfs  rw,relatime,seclabel
==&gt; omv1: │ └─/dev/mqueue                       mqueue     mqueue     rw,relatime,seclabel
==&gt; omv1: ├─/run                                tmpfs      tmpfs      rw,nosuid,nodev,seclabel,mode=755
==&gt; omv1: │ └─/run/user/1000                    tmpfs      tmpfs      rw,nosuid,nodev,relatime,seclabel,size=50112k,mode=700,uid=1000,gid=1000
==&gt; omv1: ├─/tmp                                tmpfs      tmpfs      rw,seclabel
==&gt; omv1: ├─/boot                               /dev/vda1  ext4       rw,relatime,seclabel,data=ordered
==&gt; omv1: └─/var/lib/nfs/rpc_pipefs             sunrpc     rpc_pipefs rw,relatime
==&gt; omv1: meta-data=/dev/vda3              isize=512    agcount=4, agsize=321792 blks
==&gt; omv1:          =                       sectsz=512   attr=2, projid32bit=1
==&gt; omv1:          =                       crc=1        finobt=1
==&gt; omv1: data     =                       bsize=4096   blocks=1287168, imaxpct=25
==&gt; omv1:          =                       sunit=0      swidth=0 blks
==&gt; omv1: naming   =version 2              bsize=4096   ascii-ci=0 ftype=1
==&gt; omv1: log      =internal               bsize=4096   blocks=2560, version=2
==&gt; omv1:          =                       sectsz=512   sunit=0 blks, lazy-count=1
==&gt; omv1: realtime =none                   extsz=4096   blocks=0, rtextents=0
==&gt; omv1: data blocks changed from 1287168 to 10199744
==&gt; omv1: Running provisioner: shell...
    omv1: Running: inline script
==&gt; omv1: this is ceph-deploy on fedora-23
==&gt; omv1: Last metadata expiration check performed 0:00:12 ago on Mon Dec 28 14:34:32 2015.
==&gt; omv1: Dependencies resolved.
==&gt; omv1: ================================================================================
==&gt; omv1:  Package               Arch          Version                Repository     Size
==&gt; omv1: ================================================================================
==&gt; omv1: Installing:
==&gt; omv1:  ceph-deploy           noarch        1.5.25-2.fc23          fedora        160 k
==&gt; omv1:  python-execnet        noarch        1.3.0-3.fc23           fedora        275 k
==&gt; omv1:  python-remoto         noarch        0.0.25-2.fc23          fedora         26 k
==&gt; omv1: 
==&gt; omv1: Transaction Summary
==&gt; omv1: ================================================================================
==&gt; omv1: Install  3 Packages
==&gt; omv1: Total download size: 461 k
==&gt; omv1: Installed size: 1.5 M
==&gt; omv1: Downloading Packages:
==&gt; omv1: --------------------------------------------------------------------------------
==&gt; omv1: Total                                           214 kB/s | 461 kB     00:02     
==&gt; omv1: Running transaction check
==&gt; omv1: Transaction check succeeded.
==&gt; omv1: Running transaction test
==&gt; omv1: Transaction test succeeded.
==&gt; omv1: Running transaction
==&gt; omv1:   Installing  : python-execnet-1.3.0-3.fc23.noarch                          1/3
==&gt; omv1:  
==&gt; omv1:   Installing  : python-remoto-0.0.25-2.fc23.noarch                          2/3
==&gt; omv1:  
==&gt; omv1:   Installing  : ceph-deploy-1.5.25-2.fc23.noarch                            3/3
==&gt; omv1:  
==&gt; omv1:   Verifying   : ceph-deploy-1.5.25-2.fc23.noarch                            1/3
==&gt; omv1:  
==&gt; omv1:   Verifying   : python-remoto-0.0.25-2.fc23.noarch                          2/3
==&gt; omv1:  
==&gt; omv1:   Verifying   : python-execnet-1.3.0-3.fc23.noarch                          3/3
==&gt; omv1:  
==&gt; omv1: 
==&gt; omv1: Installed:
==&gt; omv1:   ceph-deploy.noarch 1.5.25-2.fc23       python-execnet.noarch 1.3.0-3.fc23    
==&gt; omv1:   python-remoto.noarch 0.0.25-2.fc23    
==&gt; omv1: Complete!
==&gt; omv1: [ceph_deploy.conf][DEBUG ] found configuration file at: /root/.cephdeploy.conf
==&gt; omv1: [ceph_deploy.cli][INFO  ] Invoked (1.5.25): /bin/ceph-deploy new omv1.example.com
==&gt; omv1: [ceph_deploy.new][DEBUG ] Creating new cluster named ceph
==&gt; omv1: [ceph_deploy.new][INFO  ] making sure passwordless SSH succeeds
==&gt; omv1: [omv1.example.com][DEBUG ] connected to host: omv1.example.com 
==&gt; omv1: [omv1.example.com][DEBUG ] detect platform information from remote host
==&gt; omv1: [omv1.example.com][DEBUG ] detect machine type
==&gt; omv1: [omv1.example.com][DEBUG ] find the location of an executable
==&gt; omv1: [omv1.example.com][INFO  ] Running command: /usr/sbin/ip link show
==&gt; omv1: [omv1.example.com][INFO  ] Running command: /usr/sbin/ip addr show
==&gt; omv1: [omv1.example.com][DEBUG ] IP addresses found: ['192.168.123.100', '172.17.0.1', '192.168.121.48']
==&gt; omv1: [ceph_deploy.new][DEBUG ] Resolving host omv1.example.com
==&gt; omv1: [ceph_deploy.new][DEBUG ] Monitor omv1 at 192.168.123.100
==&gt; omv1: [ceph_deploy.new][DEBUG ] Monitor initial members are ['omv1']
==&gt; omv1: [ceph_deploy.new][DEBUG ] Monitor addrs are ['192.168.123.100']
==&gt; omv1: [ceph_deploy.new][DEBUG ] Creating a random mon key...
==&gt; omv1: [ceph_deploy.new][DEBUG ] Writing monitor keyring to ceph.mon.keyring...
==&gt; omv1: [ceph_deploy.new][DEBUG ] Writing initial config to ceph.conf...
==&gt; omv1: [ceph_deploy.conf][DEBUG ] found configuration file at: /root/.cephdeploy.conf
==&gt; omv1: [ceph_deploy.cli][INFO  ] Invoked (1.5.25): /bin/ceph-deploy install --no-adjust-repos omv1.example.com
==&gt; omv1: [ceph_deploy.install][DEBUG ] Installing stable version hammer on cluster ceph hosts omv1.example.com
==&gt; omv1: [ceph_deploy.install][DEBUG ] Detecting platform for host omv1.example.com ...
==&gt; omv1: [omv1.example.com][DEBUG ] connected to host: omv1.example.com 
==&gt; omv1: [omv1.example.com][DEBUG ] detect platform information from remote host
==&gt; omv1: [omv1.example.com][DEBUG ] detect machine type
==&gt; omv1: [ceph_deploy.install][INFO  ] Distro info: Fedora 23 Twenty Three
==&gt; omv1: [omv1.example.com][INFO  ] installing ceph on omv1.example.com
==&gt; omv1: [omv1.example.com][INFO  ] Running command: yum -y -q install ceph ceph-radosgw
==&gt; omv1: [omv1.example.com][WARNING] Yum command has been deprecated, redirecting to '/usr/bin/dnf -y -q install ceph ceph-radosgw'.
==&gt; omv1: [omv1.example.com][WARNING] See 'man dnf' and 'man yum2dnf' for more information.
==&gt; omv1: [omv1.example.com][WARNING] To transfer transaction metadata from yum to DNF, run:
==&gt; omv1: [omv1.example.com][WARNING] 'dnf install python-dnf-plugins-extras-migrate &amp;&amp; dnf-2 migrate'
==&gt; omv1: [omv1.example.com][WARNING] 
==&gt; omv1: [omv1.example.com][INFO  ] Running command: ceph --version
==&gt; omv1: [omv1.example.com][DEBUG ] ceph version 0.94.5 (9764da52395923e0b32908d83a9f7304401fee43)
==&gt; omv1: [ceph_deploy.conf][DEBUG ] found configuration file at: /root/.cephdeploy.conf
==&gt; omv1: [ceph_deploy.cli][INFO  ] Invoked (1.5.25): /bin/ceph-deploy mon create-initial
==&gt; omv1: [ceph_deploy.mon][DEBUG ] Deploying mon, cluster ceph hosts omv1
==&gt; omv1: [ceph_deploy.mon][DEBUG ] detecting platform for host omv1 ...
==&gt; omv1: [omv1][DEBUG ] connected to host: omv1 
==&gt; omv1: [omv1][DEBUG ] detect platform information from remote host
==&gt; omv1: [omv1][DEBUG ] detect machine type
==&gt; omv1: [ceph_deploy.mon][INFO  ] distro info: Fedora 23 Twenty Three
==&gt; omv1: [omv1][DEBUG ] determining if provided host has same hostname in remote
==&gt; omv1: [omv1][DEBUG ] get remote short hostname
==&gt; omv1: [omv1][DEBUG ] deploying mon to omv1
==&gt; omv1: [omv1][DEBUG ] get remote short hostname
==&gt; omv1: [omv1][DEBUG ] remote hostname: omv1
==&gt; omv1: [omv1][DEBUG ] write cluster configuration to /etc/ceph/{cluster}.conf
==&gt; omv1: [omv1][DEBUG ] create the mon path if it does not exist
==&gt; omv1: [omv1][DEBUG ] checking for done path: /var/lib/ceph/mon/ceph-omv1/done
==&gt; omv1: [omv1][DEBUG ] done path does not exist: /var/lib/ceph/mon/ceph-omv1/done
==&gt; omv1: [omv1][INFO  ] creating keyring file: /var/lib/ceph/tmp/ceph-omv1.mon.keyring
==&gt; omv1: [omv1][DEBUG ] create the monitor keyring file
==&gt; omv1: [omv1][INFO  ] Running command: ceph-mon --cluster ceph --mkfs -i omv1 --keyring /var/lib/ceph/tmp/ceph-omv1.mon.keyring
==&gt; omv1: [omv1][DEBUG ] ceph-mon: mon.noname-a 192.168.123.100:6789/0 is local, renaming to mon.omv1
==&gt; omv1: [omv1][DEBUG ] ceph-mon: set fsid to 94276740-7431-49ab-80da-a37325d2d020
==&gt; omv1: [omv1][DEBUG ] ceph-mon: created monfs at /var/lib/ceph/mon/ceph-omv1 for mon.omv1
==&gt; omv1: [omv1][INFO  ] unlinking keyring file /var/lib/ceph/tmp/ceph-omv1.mon.keyring
==&gt; omv1: [omv1][DEBUG ] create a done file to avoid re-doing the mon deployment
==&gt; omv1: [omv1][DEBUG ] create the init path if it does not exist
==&gt; omv1: [omv1][DEBUG ] locating the `service` executable...
==&gt; omv1: [omv1][INFO  ] Running command: /usr/sbin/service ceph -c /etc/ceph/ceph.conf start mon.omv1
==&gt; omv1: [omv1][DEBUG ] === mon.omv1 === 
==&gt; omv1: [omv1][DEBUG ] Starting Ceph mon.omv1 on omv1...
==&gt; omv1: [omv1][WARNING] Running as unit run-3493.service.
==&gt; omv1: [omv1][DEBUG ] Starting ceph-create-keys on omv1...
==&gt; omv1: [omv1][INFO  ] Running command: ceph --cluster=ceph --admin-daemon /var/run/ceph/ceph-mon.omv1.asok mon_status
==&gt; omv1: [omv1][DEBUG ] ********************************************************************************
==&gt; omv1: [omv1][DEBUG ] status for monitor: mon.omv1
==&gt; omv1: [omv1][DEBUG ] {
==&gt; omv1: [omv1][DEBUG ]   &quot;election_epoch&quot;: 2, 
==&gt; omv1: [omv1][DEBUG ]   &quot;extra_probe_peers&quot;: [], 
==&gt; omv1: [omv1][DEBUG ]   &quot;monmap&quot;: {
==&gt; omv1: [omv1][DEBUG ]     &quot;created&quot;: &quot;0.000000&quot;, 
==&gt; omv1: [omv1][DEBUG ]     &quot;epoch&quot;: 1, 
==&gt; omv1: [omv1][DEBUG ]     &quot;fsid&quot;: &quot;94276740-7431-49ab-80da-a37325d2d020&quot;, 
==&gt; omv1: [omv1][DEBUG ]     &quot;modified&quot;: &quot;0.000000&quot;, 
==&gt; omv1: [omv1][DEBUG ]     &quot;mons&quot;: [
==&gt; omv1: [omv1][DEBUG ]       {
==&gt; omv1: [omv1][DEBUG ]         &quot;addr&quot;: &quot;192.168.123.100:6789/0&quot;, 
==&gt; omv1: [omv1][DEBUG ]         &quot;name&quot;: &quot;omv1&quot;, 
==&gt; omv1: [omv1][DEBUG ]         &quot;rank&quot;: 0
==&gt; omv1: [omv1][DEBUG ]       }
==&gt; omv1: [omv1][DEBUG ]     ]
==&gt; omv1: [omv1][DEBUG ]   }, 
==&gt; omv1: [omv1][DEBUG ]   &quot;name&quot;: &quot;omv1&quot;, 
==&gt; omv1: [omv1][DEBUG ]   &quot;outside_quorum&quot;: [], 
==&gt; omv1: [omv1][DEBUG ]   &quot;quorum&quot;: [
==&gt; omv1: [omv1][DEBUG ]     0
==&gt; omv1: [omv1][DEBUG ]   ], 
==&gt; omv1: [omv1][DEBUG ]   &quot;rank&quot;: 0, 
==&gt; omv1: [omv1][DEBUG ]   &quot;state&quot;: &quot;leader&quot;, 
==&gt; omv1: [omv1][DEBUG ]   &quot;sync_provider&quot;: []
==&gt; omv1: [omv1][DEBUG ] }
==&gt; omv1: [omv1][DEBUG ] ********************************************************************************
==&gt; omv1: [omv1][INFO  ] monitor: mon.omv1 is running
==&gt; omv1: [omv1][INFO  ] Running command: ceph --cluster=ceph --admin-daemon /var/run/ceph/ceph-mon.omv1.asok mon_status
==&gt; omv1: [ceph_deploy.mon][INFO  ] processing monitor mon.omv1
==&gt; omv1: [omv1][DEBUG ] connected to host: omv1 
==&gt; omv1: [omv1][INFO  ] Running command: ceph --cluster=ceph --admin-daemon /var/run/ceph/ceph-mon.omv1.asok mon_status
==&gt; omv1: [ceph_deploy.mon][INFO  ] mon.omv1 monitor has reached quorum!
==&gt; omv1: [ceph_deploy.mon][INFO  ] all initial monitors are running and have formed quorum
==&gt; omv1: [ceph_deploy.mon][INFO  ] Running gatherkeys...
==&gt; omv1: [ceph_deploy.gatherkeys][DEBUG ] Checking omv1 for /etc/ceph/ceph.client.admin.keyring
==&gt; omv1: [omv1][DEBUG ] connected to host: omv1 
==&gt; omv1: [omv1][DEBUG ] detect platform information from remote host
==&gt; omv1: [omv1][DEBUG ] detect machine type
==&gt; omv1: [omv1][DEBUG ] fetch remote file
==&gt; omv1: [ceph_deploy.gatherkeys][DEBUG ] Got ceph.client.admin.keyring key from omv1.
==&gt; omv1: [ceph_deploy.gatherkeys][DEBUG ] Have ceph.mon.keyring
==&gt; omv1: [ceph_deploy.gatherkeys][DEBUG ] Checking omv1 for /var/lib/ceph/bootstrap-osd/ceph.keyring
==&gt; omv1: [omv1][DEBUG ] connected to host: omv1 
==&gt; omv1: [omv1][DEBUG ] detect platform information from remote host
==&gt; omv1: [omv1][DEBUG ] detect machine type
==&gt; omv1: [omv1][DEBUG ] fetch remote file
==&gt; omv1: [ceph_deploy.gatherkeys][DEBUG ] Got ceph.bootstrap-osd.keyring key from omv1.
==&gt; omv1: [ceph_deploy.gatherkeys][DEBUG ] Checking omv1 for /var/lib/ceph/bootstrap-mds/ceph.keyring
==&gt; omv1: [omv1][DEBUG ] connected to host: omv1 
==&gt; omv1: [omv1][DEBUG ] detect platform information from remote host
==&gt; omv1: [omv1][DEBUG ] detect machine type
==&gt; omv1: [omv1][DEBUG ] fetch remote file
==&gt; omv1: [ceph_deploy.gatherkeys][DEBUG ] Got ceph.bootstrap-mds.keyring key from omv1.
==&gt; omv1: [ceph_deploy.gatherkeys][DEBUG ] Checking omv1 for /var/lib/ceph/bootstrap-rgw/ceph.keyring
==&gt; omv1: [omv1][DEBUG ] connected to host: omv1 
==&gt; omv1: [omv1][DEBUG ] detect platform information from remote host
==&gt; omv1: [omv1][DEBUG ] detect machine type
==&gt; omv1: [omv1][DEBUG ] fetch remote file
==&gt; omv1: [ceph_deploy.gatherkeys][DEBUG ] Got ceph.bootstrap-rgw.keyring key from omv1.
==&gt; omv1: [ceph_deploy.conf][DEBUG ] found configuration file at: /root/.cephdeploy.conf
==&gt; omv1: [ceph_deploy.cli][INFO  ] Invoked (1.5.25): /bin/ceph-deploy osd prepare omv1.example.com:/srv/ceph/osd
==&gt; omv1: [ceph_deploy.osd][DEBUG ] Preparing cluster ceph disks omv1.example.com:/srv/ceph/osd:
==&gt; omv1: [omv1.example.com][DEBUG ] connected to host: omv1.example.com 
==&gt; omv1: [omv1.example.com][DEBUG ] detect platform information from remote host
==&gt; omv1: [omv1.example.com][DEBUG ] detect machine type
==&gt; omv1: [ceph_deploy.osd][INFO  ] Distro info: Fedora 23 Twenty Three
==&gt; omv1: [ceph_deploy.osd][DEBUG ] Deploying osd to omv1.example.com
==&gt; omv1: [omv1.example.com][DEBUG ] write cluster configuration to /etc/ceph/{cluster}.conf
==&gt; omv1: [omv1.example.com][INFO  ] Running command: udevadm trigger --subsystem-match=block --action=add
==&gt; omv1: [ceph_deploy.osd][DEBUG ] Preparing host omv1.example.com disk /srv/ceph/osd journal None activate False
==&gt; omv1: [omv1.example.com][INFO  ] Running command: ceph-disk -v prepare --fs-type xfs --cluster ceph -- /srv/ceph/osd
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/bin/ceph-osd --cluster=ceph --show-config-value=fsid
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/bin/ceph-conf --cluster=ceph --name=osd. --lookup osd_mkfs_options_xfs
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/bin/ceph-conf --cluster=ceph --name=osd. --lookup osd_fs_mkfs_options_xfs
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/bin/ceph-conf --cluster=ceph --name=osd. --lookup osd_mount_options_xfs
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/bin/ceph-conf --cluster=ceph --name=osd. --lookup osd_fs_mount_options_xfs
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/bin/ceph-osd --cluster=ceph --show-config-value=osd_journal_size
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/bin/ceph-conf --cluster=ceph --name=osd. --lookup osd_cryptsetup_parameters
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/bin/ceph-conf --cluster=ceph --name=osd. --lookup osd_dmcrypt_key_size
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/bin/ceph-conf --cluster=ceph --name=osd. --lookup osd_dmcrypt_type
==&gt; omv1: [omv1.example.com][WARNING] DEBUG:ceph-disk:Preparing osd data dir /srv/ceph/osd
==&gt; omv1: [omv1.example.com][INFO  ] checking OSD status...
==&gt; omv1: [omv1.example.com][INFO  ] Running command: ceph --cluster=ceph osd stat --format=json
==&gt; omv1: [ceph_deploy.osd][DEBUG ] Host omv1.example.com is now ready for osd use.
==&gt; omv1: [ceph_deploy.conf][DEBUG ] found configuration file at: /root/.cephdeploy.conf
==&gt; omv1: [ceph_deploy.cli][INFO  ] Invoked (1.5.25): /bin/ceph-deploy osd activate omv1.example.com:/srv/ceph/osd
==&gt; omv1: [ceph_deploy.osd][DEBUG ] Activating cluster ceph disks omv1.example.com:/srv/ceph/osd:
==&gt; omv1: [omv1.example.com][DEBUG ] connected to host: omv1.example.com 
==&gt; omv1: [omv1.example.com][DEBUG ] detect platform information from remote host
==&gt; omv1: [omv1.example.com][DEBUG ] detect machine type
==&gt; omv1: [ceph_deploy.osd][INFO  ] Distro info: Fedora 23 Twenty Three
==&gt; omv1: [ceph_deploy.osd][DEBUG ] activating host omv1.example.com disk /srv/ceph/osd
==&gt; omv1: [ceph_deploy.osd][DEBUG ] will use init type: sysvinit
==&gt; omv1: [omv1.example.com][INFO  ] Running command: ceph-disk -v activate --mark-init sysvinit --mount /srv/ceph/osd
==&gt; omv1: [omv1.example.com][WARNING] DEBUG:ceph-disk:Cluster uuid is 94276740-7431-49ab-80da-a37325d2d020
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/bin/ceph-osd --cluster=ceph --show-config-value=fsid
==&gt; omv1: [omv1.example.com][WARNING] DEBUG:ceph-disk:Cluster name is ceph
==&gt; omv1: [omv1.example.com][WARNING] DEBUG:ceph-disk:OSD uuid is 43a20af4-7a45-4f70-a0dd-baf906d58026
==&gt; omv1: [omv1.example.com][WARNING] DEBUG:ceph-disk:Allocating OSD id...
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/bin/ceph --cluster ceph --name client.bootstrap-osd --keyring /var/lib/ceph/bootstrap-osd/ceph.keyring osd create --concise 43a20af4-7a45-4f70-a0dd-baf906d58026
==&gt; omv1: [omv1.example.com][WARNING] DEBUG:ceph-disk:OSD id is 0
==&gt; omv1: [omv1.example.com][WARNING] DEBUG:ceph-disk:Initializing OSD...
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/bin/ceph --cluster ceph --name client.bootstrap-osd --keyring /var/lib/ceph/bootstrap-osd/ceph.keyring mon getmap -o /srv/ceph/osd/activate.monmap
==&gt; omv1: [omv1.example.com][WARNING] got monmap epoch 1
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/bin/ceph-osd --cluster ceph --mkfs --mkkey -i 0 --monmap /srv/ceph/osd/activate.monmap --osd-data /srv/ceph/osd --osd-journal /srv/ceph/osd/journal --osd-uuid 43a20af4-7a45-4f70-a0dd-baf906d58026 --keyring /srv/ceph/osd/keyring
==&gt; omv1: [omv1.example.com][WARNING] 2015-12-28 14:36:47.525213 7f66f9f0c880 -1 journal FileJournal::_open: disabling aio for non-block journal.  Use journal_force_aio to force use of aio anyway
==&gt; omv1: [omv1.example.com][WARNING] 2015-12-28 14:36:49.412257 7f66f9f0c880 -1 journal FileJournal::_open: disabling aio for non-block journal.  Use journal_force_aio to force use of aio anyway
==&gt; omv1: [omv1.example.com][WARNING] 2015-12-28 14:36:49.413018 7f66f9f0c880 -1 filestore(/srv/ceph/osd) could not find 23c2fcde/osd_superblock/0//-1 in index: (2) No such file or directory
==&gt; omv1: [omv1.example.com][WARNING] 2015-12-28 14:36:49.813515 7f66f9f0c880 -1 created object store /srv/ceph/osd journal /srv/ceph/osd/journal for osd.0 fsid 94276740-7431-49ab-80da-a37325d2d020
==&gt; omv1: [omv1.example.com][WARNING] 2015-12-28 14:36:49.813566 7f66f9f0c880 -1 auth: error reading file: /srv/ceph/osd/keyring: can't open /srv/ceph/osd/keyring: (2) No such file or directory
==&gt; omv1: [omv1.example.com][WARNING] 2015-12-28 14:36:49.813683 7f66f9f0c880 -1 created new key in keyring /srv/ceph/osd/keyring
==&gt; omv1: [omv1.example.com][WARNING] DEBUG:ceph-disk:Marking with init system sysvinit
==&gt; omv1: [omv1.example.com][WARNING] DEBUG:ceph-disk:Authorizing OSD key...
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/bin/ceph --cluster ceph --name client.bootstrap-osd --keyring /var/lib/ceph/bootstrap-osd/ceph.keyring auth add osd.0 -i /srv/ceph/osd/keyring osd allow * mon allow profile osd
==&gt; omv1: [omv1.example.com][WARNING] added key for osd.0
==&gt; omv1: [omv1.example.com][WARNING] DEBUG:ceph-disk:ceph osd.0 data dir is ready at /srv/ceph/osd
==&gt; omv1: [omv1.example.com][WARNING] DEBUG:ceph-disk:Creating symlink /var/lib/ceph/osd/ceph-0 -&gt; /srv/ceph/osd
==&gt; omv1: [omv1.example.com][WARNING] DEBUG:ceph-disk:Starting ceph osd.0...
==&gt; omv1: [omv1.example.com][WARNING] INFO:ceph-disk:Running command: /usr/sbin/service ceph --cluster ceph start osd.0
==&gt; omv1: [omv1.example.com][DEBUG ] === osd.0 === 
==&gt; omv1: [omv1.example.com][WARNING] create-or-move updating item name 'osd.0' weight 0.04 at location {host=omv1,root=default} to crush map
==&gt; omv1: [omv1.example.com][DEBUG ] Starting Ceph osd.0 on omv1...
==&gt; omv1: [omv1.example.com][WARNING] Running as unit run-4116.service.
==&gt; omv1: [omv1.example.com][INFO  ] checking OSD status...
==&gt; omv1: [omv1.example.com][INFO  ] Running command: ceph --cluster=ceph osd stat --format=json
==&gt; omv1: [omv1.example.com][INFO  ] Running command: systemctl enable ceph
==&gt; omv1: [omv1.example.com][WARNING] ceph.service is not a native service, redirecting to systemd-sysv-install
==&gt; omv1: [omv1.example.com][WARNING] Executing /usr/lib/systemd/systemd-sysv-install enable ceph
==&gt; omv1:     cluster 94276740-7431-49ab-80da-a37325d2d020
==&gt; omv1:      health HEALTH_WARN
==&gt; omv1:             64 pgs stuck inactive
==&gt; omv1:             64 pgs stuck unclean
==&gt; omv1:      monmap e1: 1 mons at {omv1=192.168.123.100:6789/0}
==&gt; omv1:             election epoch 2, quorum 0 omv1
==&gt; omv1:      osdmap e5: 1 osds: 1 up, 1 in
==&gt; omv1:       pgmap v6: 64 pgs, 1 pools, 0 bytes data, 0 objects
==&gt; omv1:             0 kB used, 0 kB / 0 kB avail
==&gt; omv1:                   64 creating
==&gt; omv1: you can now use ceph with the rbd command

real    4m14.815s
user    0m2.239s
sys    0m0.288s
james@computer:/tmp/tmp.DhD$ vscreen root@omv1
[root@omv1 ~]# ceph status
    cluster 94276740-7431-49ab-80da-a37325d2d020
     health HEALTH_OK
     monmap e1: 1 mons at {omv1=192.168.123.100:6789/0}
            election epoch 2, quorum 0 omv1
     osdmap e5: 1 osds: 1 up, 1 in
      pgmap v9: 64 pgs, 1 pools, 0 bytes data, 0 objects
            6642 MB used, 33190 MB / 39832 MB avail
                  64 active+clean
[root@omv1 ~]#
</code></pre>

<p>You&rsquo;ll notice that the <code>ceph status</code> command initially returned a warning when run with OMV, but you&rsquo;ll notice that if I logged in to the machine and ran it a second time, everything is now happy. I imagine this is because it takes a moment to converge on a healthy state.</p>

<p><a href="https://twitter.com/purpleidea/status/681562552019456000">I&rsquo;ve also just released a new Fedora-23 vagrant box</a>, which is what this example uses. Naturally if you haven&rsquo;t already downloaded the box, this example will take a bit longer to run the first time. The download will cost you about 865M and will happen automatically if you&rsquo;re missing the box.</p>

<p>Happy hacking!</p>

<p>James</p>

<p>PS: If you&rsquo;re curious what that <code>cdtmpmkdir</code> is, it&rsquo;s here:</p>

<pre><code>$ type cdtmpmkdir 
cdtmpmkdir is a function
cdtmpmkdir () 
{ 
    cd `mktemp --tmpdir -d tmp.XXX`
}
</code></pre>

			</div>
		</div>

		
		<div class="col-md-3">
			<div class="well well-sm"> 
				<h4>December 28, 2015<br>
				<small>2903 words</small></h4>
				<hr>
				<strong>Categories</strong>
				<ul class="list-unstyled">
				
					<li><a href="/categories/technical">technical</a></li>
				
				</ul>
				<hr>
				<strong>Tags</strong><br>
				<a class="label label-default" href="/tags/bash">bash</a> <a class="label label-default" href="/tags/ceph">ceph</a> <a class="label label-default" href="/tags/ceph-deploy">ceph-deploy</a> <a class="label label-default" href="/tags/devops">devops</a> <a class="label label-default" href="/tags/fedora">fedora</a> <a class="label label-default" href="/tags/fedora-23">fedora 23</a> <a class="label label-default" href="/tags/hack">hack</a> <a class="label label-default" href="/tags/oh-my-vagrant">oh-my-vagrant</a> <a class="label label-default" href="/tags/planetdevops">planetdevops</a> <a class="label label-default" href="/tags/planetfedora">planetfedora</a> <a class="label label-default" href="/tags/planetpuppet">planetpuppet</a> <a class="label label-default" href="/tags/rbd">rbd</a> <a class="label label-default" href="/tags/vagrant">vagrant</a> 
				
				<hr>
				<strong>Original URL</strong><br>
				<a href="https://ttboj.wordpress.com/2015/12/28/trying-out-ceph-with-oh-my-vagrant/"><small>https://ttboj.wordpress.com/2015/12/28/trying-out-ceph-with-oh-my-vagrant/</small></a>
				

				
			</div>
				<div class="panel panel-default">
		<div class="panel-heading" style="padding: 2px 15px;">
			<h4>Oh hello...</h4>
		</div>
		<div class="panel-body">

			<a href="https://twitter.com/purpleidea" class="btn btn-info btn-xs"><i class="fa fa-twitter-square fa-2x"></i></a>


			<a href="https://github.com/purpleidea/" class="btn btn-primary btn-xs"><i class="fa fa-github-square fa-2x"></i></a>



			<div class="alert alert-info alert-dismissable" style="margin-top:25px;margin-bottom:5px;">
				<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
				<strong>Hey, hacker!</strong><br>
				You should follow me to get new updates!
			</div>
		</div>
	</div>

		</div>
	</div>

	<div class="row">
		<hr>

	<a name="comments"></a>
<section class="post-comments">
	<h3>Comments</h3>






	

	


	<p>Nothing yet.</p>

	<hr />
	<a name="comment"></a>
	<h3>Post a comment</h3>
	<form class="post-new-comment" method="POST" action="https://api.staticman.net/v2/entry/purpleidea/purpleidea.com/master/comments">
		<input type="hidden" name="options[redirect]" value="https://purpleidea.com/blog/2015/12/28/trying-out-ceph-with-oh-my-vagrant/#comment-submitted">
		<input type="hidden" name="options[entryId]" value="blog/2015/12/28/trying-out-ceph-with-oh-my-vagrant">
		<div class="col-md-9">
			<div class="row">
				<textarea name="fields[message]" style="width: 80%; height: 50px;" class="post-comment-field" placeholder="Please enter your comment here..." rows="10"></textarea><br />
			</div>
			<div class="row">
				<input name="fields[name]" type="text" style="width: 50%;" class="post-comment-field" placeholder="Your name">
			</div>
			<div class="row">
				<input name="fields[email]" type="email" style="width: 50%;" class="post-comment-field" placeholder="Your email address">
			</div>
			<div class="row">
				<input name="fields[url]" type="text" style="width: 50%;" class="post-comment-field" placeholder="Your website">
			</div>
			<div class="row">
				<input type="submit" style="width: 80%;" class="post-comment-field btn btn-primary btn-xs" value="Submit">
			</div>
		</div>
	</form>
</section>

<div id="comment-submitted" class="dialog">
	<hr />
	<h3>Thank you</h3>
	<p>Your comment has been submitted and will be published if it gets approved.</p>
	<p><a href="https://github.com/purpleidea/purpleidea.com/pulls">Click here</a> to see the patch you generated.</p>
	<p><a href="#" class="btn">OK</a></p>
</div>

	</div>
		<footer>
		<div class="row">
			<hr>
			<div class="col-sm-12">
				<p>
				&copy; James Shubin 2018 &middot;
				<a href="https://purpleidea.com/">https://purpleidea.com/</a> &middot;
				<a href="https://github.com/purpleidea/purpleidea.com/blob/master/content/blog/2015/12/28/trying-out-ceph-with-oh-my-vagrant.md" style="color:grey">Edit this page</a>
				</p>
			</div>
		</div>
		</footer>
	</div>

	<script src="/js/jquery-1.11.3.min.js"></script>
	<script src="/js/bootstrap.js"></script>
</body>
</html>

