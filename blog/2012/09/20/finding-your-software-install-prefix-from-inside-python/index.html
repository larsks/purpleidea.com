<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="">
	<meta name="author" content="James Shubin">

	<title>finding your software install $prefix from inside python - https://purpleidea.com/</title>
	<link rel="canonical" href="https://purpleidea.com/blog/2012/09/20/finding-your-software-install-prefix-from-inside-python/">

	<link href="/css/bootstrap.min.css" rel="stylesheet">
	<link href="/css/font-awesome.css" rel="stylesheet">
	<link href="/css/custom.css" rel="stylesheet">
	<link href="/css/staticman.css" rel="stylesheet">

	
</head>
<body>
	<nav class="navbar navbar-default navbar-fixed-top" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
					<span class="sr-only">Toggle Navigation</span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
					<span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="https://purpleidea.com/">purpleidea.com</a>
			</div>
			<div class="collapse navbar-collapse navbar-ex1-collapse">
				<ul class="nav navbar-nav">

					<li><a href="/about/">about</a></li>
					<li><a href="/blog/">blog</a></li>
					<li><a href="/contact/">contact</a></li>
					<li><a href="/misc/">misc</a></li>
					<li><a href="/talks/">talks</a></li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container">

	<div class="row">
		<div class="col-md-9">
			<div class="well well-sm">
					<h3><strong>finding your software install $prefix from inside python</strong><br><small></small></h3>
					<hr>
					<p>Good python software developers tend to use <a href="http://docs.python.org/library/distutils.html">distutils</a> and include a setup.py with their code. The problem I often encounter is finding out which prefix your software has been installed in from within the python code. This might be necessary if you want to interact with some data that you&rsquo;ve installed into: $prefix/share/projectname/ Here are the various steps:</p>

<p><strong>1) <span style="text-decoration:underline;">Distutils</span>:</strong>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">NAME<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;someproject&#39;</span>
distutils<span style="color:#f92672">.</span>core<span style="color:#f92672">.</span>setup(
    name<span style="color:#f92672">=</span>NAME,
    version<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;0.1&#39;</span>,
    author<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;James Shubin&#39;</span>,
    author_email<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;secret@purpleidea.com&#39;</span>,
    url<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;https://purpleidea.com/&#39;</span>,
    description<span style="color:#f92672">=</span><span style="color:#e6db74"></span><span style="color:#e6db74">&#39;This is an example project&#39;</span>,
    <span style="color:#75715e"># http://pypi.python.org/pypi?%3Aaction=list_classifiers</span>
    classifiers<span style="color:#f92672">=</span>[
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;Environment :: Console&#39;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;Intended Audience :: System Administrators&#39;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;License :: OSI Approved :: GNU Affero General Public License v3&#39;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;Operating System :: POSIX :: Linux&#39;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;Programming Language :: Python&#39;</span>,
        <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;Topic :: Utilities&#39;</span>,
    ],
    packages<span style="color:#f92672">=</span>[NAME],
    package_dir<span style="color:#f92672">=</span>{NAME: <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;src&#39;</span>},
    data_files<span style="color:#f92672">=</span>[
        (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;share/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> NAME, [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;README&#39;</span>]),
        (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;share/</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> NAME, [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;images/something.png&#39;</span>]),
    ],
    scripts<span style="color:#f92672">=</span>[<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;somebin&#39;</span>],
)</code></pre></div></p>

<p><strong>2) <span style="text-decoration:underline;">Install</span>:</strong></p>

<pre><code>python setup.py install --prefix=~/testprefix/
</code></pre>

<p><em>Note: If you don&rsquo;t specify a prefix, then this will get installed into your system prefix.</em></p>

<p><strong>3) <span style="text-decoration:underline;">Run</span>:</strong></p>

<pre><code>cd ~/testprefix/ # the prefix you chose above
PYTHONPATH=lib/python2.7/site-packages/ ./bin/somebin
</code></pre>

<p><em>Note: If you didn&rsquo;t specify a prefix above, then you don&rsquo;t need to set the PYTHONPATH variable, and also, the executable will already be in your default $PATH</em></p>

<p><strong>4) <span style="text-decoration:underline;">Prefix</span>:</strong></p>

<p>I have written a small python module which I include in all of my python software. It will returns the projects installed prefix when run. I usually use it like so:</p>

<pre><code>print 'something.png is located at: %s' % os.path.join(prefix.prefix(), 'share', NAME, 'images', 'something.png')
</code></pre>

<p><strong>5) <span style="text-decoration:underline;">Code</span>:</strong></p>

<p>Here is the code for <em>prefix.py</em>. I put this file under my <em>projectname/src/</em> directory.</p>

<p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#75715e">#!/usr/bin/python</span>
<span style="color:#75715e"># -*- coding: utf-8 -*-</span>
<span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;Find the prefix of the current installation, and other useful variables.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">Finding the prefix that your program has been installed in can be non-trivial.
</span><span style="color:#e6db74">This simplifies the process by allowing you to import &lt;packagename&gt;.prefix and
</span><span style="color:#e6db74">get instant access to the path prefix by calling the function named: prefix().
</span><span style="color:#e6db74">If you&#39;d like to join this prefix onto a given path, pass it as the first arg.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">Example: if [ `./prefix.py` ]; then echo yes; else echo no; fi
</span><span style="color:#e6db74">Example: x=`./prefix.py`; echo &#39;prefix: &#39;$x
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
<span style="color:#75715e"># Copyright (C) 2010-2012  James Shubin</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e"># This program is free software: you can redistribute it and/or modify</span>
<span style="color:#75715e"># it under the terms of the GNU Affero General Public License as published by</span>
<span style="color:#75715e"># the Free Software Foundation, either version 3 of the License, or</span>
<span style="color:#75715e"># (at your option) any later version.</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e"># This program is distributed in the hope that it will be useful,</span>
<span style="color:#75715e"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span style="color:#75715e"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span style="color:#75715e"># GNU Affero General Public License for more details.</span>
<span style="color:#75715e">#</span>
<span style="color:#75715e"># You should have received a copy of the GNU Affero General Public License</span>
<span style="color:#75715e"># along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

__all__ <span style="color:#f92672">=</span> (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;prefix&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;name&#39;</span>)
<span style="color:#75715e">#DEBUG = False</span>

<span style="color:#f92672">import</span> os
<span style="color:#f92672">import</span> sys

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">prefix</span>(join<span style="color:#f92672">=</span>None):
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;Returns the prefix that this code was installed into.&#34;&#34;&#34;</span>
    <span style="color:#75715e"># constants for this execution</span>
    path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>abspath(__file__)
    <span style="color:#75715e">#if DEBUG: print &#39;path: %s&#39; % path</span>
    name <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>basename(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(path))
    <span style="color:#75715e">#if DEBUG: print &#39;name: %s&#39; % name</span>
    this <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>basename(path)
    <span style="color:#75715e">#if DEBUG: print &#39;this: %s&#39; % this</span>

    <span style="color:#75715e"># rule set</span>
    rules <span style="color:#f92672">=</span> [
        <span style="color:#75715e"># to match: /usr/lib/python2.5/site-packages/project/prefix.py</span>
        <span style="color:#75715e"># or: /usr/local/lib/python2.6/dist-packages/project/prefix.py</span>
        <span style="color:#66d9ef">lambda</span> x: x <span style="color:#f92672">==</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;lib&#39;</span>,
        <span style="color:#66d9ef">lambda</span> x: x <span style="color:#f92672">==</span> (<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;python</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> sys<span style="color:#f92672">.</span>version[:<span style="color:#ae81ff">3</span>]),
        <span style="color:#66d9ef">lambda</span> x: x <span style="color:#f92672">in</span> [<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;site-packages&#39;</span>, <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;dist-packages&#39;</span>],
        <span style="color:#66d9ef">lambda</span> x: x <span style="color:#f92672">==</span> name,    <span style="color:#75715e"># &#39;project&#39;</span>
        <span style="color:#66d9ef">lambda</span> x: x <span style="color:#f92672">==</span> this,    <span style="color:#75715e"># &#39;prefix.py&#39;</span>
    ]

    <span style="color:#75715e"># matching engine</span>
    <span style="color:#66d9ef">while</span> len(rules) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
        (path, token) <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>split(path)
        <span style="color:#75715e">#if DEBUG: print &#39;path: %s, token: %s&#39; % (path, token)</span>
        rule <span style="color:#f92672">=</span> rules<span style="color:#f92672">.</span>pop()
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> rule(token):
            <span style="color:#75715e">#if DEBUG: print &#39;rule failed&#39;</span>
            <span style="color:#66d9ef">return</span> False

    <span style="color:#75715e"># usually returns: /usr/ or /usr/local/ (but without slash postfix)</span>
    <span style="color:#66d9ef">if</span> join <span style="color:#f92672">is</span> None:
        <span style="color:#66d9ef">return</span> path
    <span style="color:#66d9ef">else</span>:
        <span style="color:#66d9ef">return</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(path, join)    <span style="color:#75715e"># add on join if it exists!</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">name</span>(pop<span style="color:#f92672">=</span>[], suffix<span style="color:#f92672">=</span>None):
    <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;&#34;&#34;Returns the name of this particular project. If pop is a list
</span><span style="color:#e6db74">    containing more than one element, name() will remove those items
</span><span style="color:#e6db74">    from the path tail before deciding on the project name. If there
</span><span style="color:#e6db74">    is an element which does not exist in the path tail, then raise.
</span><span style="color:#e6db74">    If a suffix is specified, then it is removed if found at end.&#34;&#34;&#34;</span>
    path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>abspath(__file__))
    <span style="color:#66d9ef">if</span> isinstance(pop, str): pop <span style="color:#f92672">=</span> [pop]    <span style="color:#75715e"># force single strings to list</span>
    <span style="color:#66d9ef">while</span> len(pop) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
        (path, tail) <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>split(path)
        <span style="color:#66d9ef">if</span> pop<span style="color:#f92672">.</span>pop() <span style="color:#f92672">!=</span> tail:
            <span style="color:#75715e">#if DEBUG: print &#39;tail: %s&#39; % tail</span>
            <span style="color:#66d9ef">raise</span> <span style="color:#a6e22e">ValueError</span>(<span style="color:#e6db74"></span><span style="color:#e6db74">&#39;Element doesnʼt match path tail.&#39;</span>)

    path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>basename(path)
    <span style="color:#66d9ef">if</span> suffix <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None <span style="color:#f92672">and</span> path<span style="color:#f92672">.</span>endswith(suffix):
        path <span style="color:#f92672">=</span> path[<span style="color:#ae81ff">0</span>:<span style="color:#f92672">-</span>len(suffix)]
    <span style="color:#66d9ef">return</span> path

<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39;__main__&#39;</span>:
    join <span style="color:#f92672">=</span> None
    <span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
        join <span style="color:#f92672">=</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">.</span>join(sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>:])
    result <span style="color:#f92672">=</span> prefix(join)
    <span style="color:#66d9ef">if</span> result:
        <span style="color:#66d9ef">print</span> result
    <span style="color:#66d9ef">else</span>:
        sys<span style="color:#f92672">.</span>exit(<span style="color:#ae81ff">1</span>)</code></pre></div>
Why this sort of thing isn&rsquo;t built into python boggles my mind, so if for some reason you have a better solution, please let me know. Also, don&rsquo;t be fooled by the red herring that is: sys.prefix</p>

<p>Happy hacking,
James</p>

			</div>
		</div>

		
		<div class="col-md-3">
			<div class="well well-sm"> 
				<h4>September 20, 2012<br>
				<small>803 words</small></h4>
				<hr>
				<strong>Categories</strong>
				<ul class="list-unstyled">
				
					<li><a href="/categories/technical">technical</a></li>
				
				</ul>
				<hr>
				<strong>Tags</strong><br>
				<a class="label label-default" href="/tags/agpl3">agpl3</a> <a class="label label-default" href="/tags/devops">devops</a> <a class="label label-default" href="/tags/distutils">distutils</a> <a class="label label-default" href="/tags/prefix">prefix</a> <a class="label label-default" href="/tags/python">python</a> 
				
				<hr>
				<strong>Original URL</strong><br>
				<a href="https://ttboj.wordpress.com/2012/09/20/finding-your-software-install-prefix-from-inside-python/"><small>https://ttboj.wordpress.com/2012/09/20/finding-your-software-install-prefix-from-inside-python/</small></a>
				

				
			</div>
				<div class="panel panel-default">
		<div class="panel-heading" style="padding: 2px 15px;">
			<h4>Oh hello...</h4>
		</div>
		<div class="panel-body">

			<a href="https://twitter.com/purpleidea" class="btn btn-info btn-xs"><i class="fa fa-twitter-square fa-2x"></i></a>


			<a href="https://github.com/purpleidea/" class="btn btn-primary btn-xs"><i class="fa fa-github-square fa-2x"></i></a>



			<div class="alert alert-info alert-dismissable" style="margin-top:25px;margin-bottom:5px;">
				<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
				<strong>Hey, hacker!</strong><br>
				You should follow me to get new updates!
			</div>
		</div>
	</div>

		</div>
	</div>

	<div class="row">
		<hr>

	<a name="comments"></a>
<section class="post-comments">
	<h3>Comments</h3>






	

	


	<p>Nothing yet.</p>

	<hr />
	<a name="comment"></a>
	<h3>Post a comment</h3>
	<form class="post-new-comment" method="POST" action="https://api.staticman.net/v2/entry/purpleidea/purpleidea.com/master/comments">
		<input type="hidden" name="options[redirect]" value="https://purpleidea.com/blog/2012/09/20/finding-your-software-install-prefix-from-inside-python/#comment-submitted">
		<input type="hidden" name="options[entryId]" value="blog/2012/09/20/finding-your-software-install-prefix-from-inside-python">
		<input type="hidden" name="options[reCaptcha][siteKey]" value="6Lc0u2EUAAAAAImKX7XafINIzeoLZFQCGFKF7qCp">
		<input type="hidden" name="options[reCaptcha][secret]" value="AEl4ul2uMOx2EL2LMm/84zzh8mWLYIYW&#43;v2EEu7webGOtAqyQiLBa6QLjPgnlyNjJxE3UeccxuBQIWqPzG96FsVl0AVTihhHt3OGR1hteAZUAhoJjnH&#43;7PoyC3x7d4KDLypopDn&#43;HzWowOpAZuvfHE08n&#43;G4omrP5fUfkOrH03A=">
		<div class="col-md-9">
			<div class="row">
				<textarea name="fields[message]" style="width: 80%; height: 50px;" class="post-comment-field" placeholder="Please enter your comment here..." rows="10"></textarea><br />
			</div>
			<div class="row">
				<input name="fields[name]" type="text" style="width: 50%;" class="post-comment-field" placeholder="Your name">
			</div>
			<div class="row">
				<input name="fields[email]" type="email" style="width: 50%;" class="post-comment-field" placeholder="Your email address">
			</div>
			<div class="row">
				<input name="fields[url]" type="text" style="width: 50%;" class="post-comment-field" placeholder="Your website">
			</div>
			<div class="row">
				<br />
				<div class="g-recaptcha" data-sitekey="6Lc0u2EUAAAAAImKX7XafINIzeoLZFQCGFKF7qCp"></div>
				<script src='https://www.google.com/recaptcha/api.js'></script>
				(sorry but the spammers were getting too crazy!)
			</div>
			<div class="row">
				<input type="submit" style="width: 80%;" class="post-comment-field btn btn-primary btn-xs" value="Submit">
			</div>
		</div>
	</form>
</section>

<div id="comment-submitted" class="dialog">
	<hr />
	<h3>Thank you</h3>
	<p>Your comment has been submitted and will be published if it gets approved.</p>
	<p><a href="https://github.com/purpleidea/purpleidea.com/pulls">Click here</a> to see the patch you generated.</p>
	<p><a href="#" class="btn">OK</a></p>
</div>

	</div>
		<footer>
		<div class="row">
			<hr>
			<div class="col-sm-12">
				<p>
				&copy; James Shubin 2018 &middot;
				<a href="https://purpleidea.com/">https://purpleidea.com/</a> &middot;
				<a href="https://github.com/purpleidea/purpleidea.com/blob/master/content/blog/2012/09/20/finding-your-software-install-prefix-from-inside-python.md" style="color:grey">Edit this page</a>
				</p>
			</div>
		</div>
		</footer>
	</div>

	<script src="/js/jquery-1.11.3.min.js"></script>
	<script src="/js/bootstrap.js"></script>
</body>
</html>

